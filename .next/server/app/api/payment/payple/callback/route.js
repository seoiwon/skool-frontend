(()=>{var e={};e.id=330,e.ids=[330],e.modules={3931:e=>{function webpackEmptyContext(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id=3931,e.exports=webpackEmptyContext},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},3683:()=>{},4041:()=>{},3995:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>P,originalPathname:()=>d,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>_,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>l});var s={};r.r(s),r.d(s,{POST:()=>POST});var a=r(6963),o=r(5533),n=r(5999),i=r(9988);async function POST(e){try{if(!i.O)return n.Z.json({error:"Database not configured"},{status:500});let t=await e.json();if(console.log("Payple 콜백 데이터:",t),"success"!==t.PCD_PAY_RST)return n.Z.json({success:!1,message:t.PCD_PAY_MSG||"결제 인증에 실패했습니다."});{let e={PCD_CPAY_VER:"1.0.1",PCD_PAY_TYPE:"card",PCD_CLIENT_KEY:"test_DF55F29DA654A8CBC0F0A9DD4B556486",PCD_PAY_WORK:"PAY",PCD_AUTH_KEY:t.PCD_AUTH_KEY,PCD_PAY_REQKEY:t.PCD_PAY_REQKEY,PCD_PAY_COFURL:t.PCD_PAY_COFURL,PCD_PAY_OID:t.PCD_PAY_OID,PCD_PAY_GOODS:t.PCD_PAY_GOODS,PCD_PAY_TOTAL:t.PCD_PAY_TOTAL,PCD_PAYER_NO:t.PCD_PAYER_NO,PCD_PAYER_NAME:t.PCD_PAYER_NAME,PCD_PAYER_EMAIL:t.PCD_PAYER_EMAIL},r=await fetch("https://cpay.payple.kr/php/auth.php",{method:"POST",headers:{"Content-Type":"application/json",Referer:"http://localhost:3000"},body:JSON.stringify(e)}),s=await r.json();if(console.log("결제 승인 결과:",s),"success"===s.PCD_PAY_RST)return await savePaymentResult(s),n.Z.json({success:!0,message:"결제가 완료되었습니다.",data:s});return n.Z.json({success:!1,message:s.PCD_PAY_MSG||"결제 승인에 실패했습니다."})}}catch(e){return console.error("결제 콜백 처리 오류:",e),n.Z.json({success:!1,message:"결제 처리 중 오류가 발생했습니다."},{status:500})}}async function savePaymentResult(e){try{let t=e.PCD_PAY_OID.split("_"),r=t[1],s=t[2],{data:a,error:o}=await i.O.from("payments").insert({id:e.PCD_PAY_OID,user_id:s,course_id:r,amount:parseInt(e.PCD_PAY_TOTAL),payment_method:"card",payment_status:"completed",transaction_id:e.PCD_PAY_NO,payment_data:e}).select().single();if(o)throw console.error("결제 정보 저장 실패:",o),o;let{error:n}=await i.O.from("course_enrollments").insert({user_id:s,course_id:r,payment_id:a.id});if(n)throw console.error("수강 등록 실패:",n),n;let{error:c}=await i.O.rpc("increment_students_count",{course_id:r});c&&console.error("수강생 수 업데이트 실패:",c),console.log("결제 및 수강 등록 완료:",a.id)}catch(e){throw console.error("결제 결과 저장 오류:",e),e}}let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/payment/payple/callback/route",pathname:"/api/payment/payple/callback",filename:"route",bundlePath:"app/api/payment/payple/callback/route"},resolvedPagePath:"/home/mustard-3/Documents/code/skool/frontend/app/api/payment/payple/callback/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:u,serverHooks:_,headerHooks:P,staticGenerationBailout:l}=c,d="/api/payment/payple/callback/route"},9988:(e,t,r)=>{"use strict";r.d(t,{O:()=>n});var s=r(3630);let a="https://pgtsxojnziyfkgghzmib.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBndHN4b2pueml5ZmtnZ2h6bWliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA0MDEwMjMsImV4cCI6MjA2NTk3NzAyM30.BP9rHr3lfNhMCYPLulyj3ia2z8Q9sbsc1xqS1mjVJ8g",n=a&&o?(0,s.eI)(a,o):null}};var t=require("../../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[546,508],()=>__webpack_exec__(3995));module.exports=r})();